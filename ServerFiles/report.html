<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>问题汇报</title>
<script src="js/Encryption/Base64.js"></script>
<script src="js/jquery-3.2.1.js"></script>
<script src="js/Bootstrap-3.3.7.js"></script>
<script src="js/CryptoJS/crypto-js.js"></script>
<script src="js/Encryption/SHAHash.js"></script>
<script src="js/Encryption/MD5.js"></script>
<script src="SchBMgr_js/WeiXinModule.js"></script>
<script src="SchBMgr_js/WCServicesProvider.js"></script>
<script src="SchBMgr_js/UserActivity.js"></script>
<link rel="stylesheet" href="css/bootstrap.css">
<link rel="stylesheet" href="css/SchBCSS.css">
</head>

<body class="BodyStyle">
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#defaultNavbar1"
                    aria-expanded="false"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
      <a class="navbar-brand" href="index.html" id="PgTitleBar">🏠回主页</a> </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="defaultNavbar1">
      <ul class="nav navbar-nav">
        <li><a href="index.html">概述</a></li>
        <li class="active"><a href="report.html">汇报问题</a></li>
        <li><a href="#">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></li>
        <li><a href="usermanage.html">用户管理</a></li>
        <li><a href="RptBug.html">反馈Bug</a></li>
        <li><a href="" id="navUsrName" onclick="RemoveLoginData()">注销当前账户</a></li>
      </ul>
    </div>
  </div>
</nav>
<div class="container">
  <div class="container">
    <div class="col-lg-1 col-sm-2 col-xs-5 col-lg-offset-0"><img id="UserHImg" src="Backgrounds/404-1.jpg" width="64" height="64" alt="" /></div>
    <div class="col-lg-offset-0 col-lg-3">
      <h4 id="UserID">加载中...</h4>
      <h5 id="BusDirection">我的校车: 加载中...</h5>
    </div>
  </div>
  <hr>
  <div class="container">
    <h4>汇报</h4>
    <input type="radio" name="Tag" id="ReportType0" value="0" checked/>
    <label for="ReportType0">堵车</label>
    <input type="radio" name="Tag" id="ReportType1" value="1"/>
    <label for="ReportType1">事故</label>
    <input type="radio" name="Tag" id="ReportType9" value="9"/>
    <label for="ReportType9">其他</label>
  </div>
  <br>
  <textarea id="content" class="center-all"
              style="border-radius: 20px 20px 20px 20px; border:4px solid darkgray;
               width: 80%; height: 120px; padding: 10px" placeholder="简略描述"></textarea>
  <br>
  <button class="btn btn-success btn-md center-all" id="NewRptBtn" onClick="NewReport();" style="width: 60%">提交</button>
</div>
<div class="xnav" style="font-size: 11px">Woodenbench for Schoolbus 2017-2018</div>
<script>
	 var currentUser;
	var p;
	 Maininit("report.html", mainInitCallback);
	var currentBus;
	
	function BusCallBack(data)
	{
		currentBus = data;
		setCookie("CBusID", currentBus.busID); 
		$("#BusDirection").text("我的校车: " + currentBus.Name);
	}
	
	function mainInitCallback(cUser)
    {
		currentUser = cUser;
		document.getElementById("navUsrName").innerHTML = "注销当前账户  -  " + currentUser[8];
		document.getElementById("UserID").innerHTML = "你好，" + currentUser[8];
		$("#UserHImg").prop("src", "https://res.lhy0403.top/WBUserHeadImg/" + currentUser[4]);
		GetMgmtBus(currentUser[0], currentUser[1], currentUser[2], BusCallBack);
	}
	
	function NewCallBack(data)
	{
		if(data === false)
		{
			return;
		}			
		$("#NewRptBtn").attr("disabled", null);
		$("#NewRptBtn").text("提交成功");
		alert("提交成功, 你将会被重定向");
		location.href = "index.html";
		p = data;
	}
	
	function NewReport()
	{
		$("#NewRptBtn").attr("disabled", "");
		var TypeX;
		if (document.getElementById("ReportType0").checked) TypeX = 0;
		else if (document.getElementById("ReportType1").checked) TypeX = 1;
		else if (document.getElementById("ReportType9").checked) TypeX = 9;
		
		UserNewReport(currentUser[0], currentBus.busID, TypeX, $("#content").val(), NewCallBack);
	}
	</script>
</body>
</html>
